-  All Load Balancers have health check capability
- Application Load Balancers for HTTP / HTTPs & Websocket
- Network Load Balancer for TCP
- **CLB and ALB** support **SSL certificates** and provide SSL termination
- **Stickiness works for CLB & ALB**



# 1. ALB

- Stickiness can be enabled at the target group level
  - Same request goes to the same instance
  - Stickiness is directly generated by the ALB (not the application)
  - The “cookie” used for stickiness has an expiration date you control
  - Use case: make sure the user doesn’t lose his session data
  - Enabling stickiness may bring imbalance to the load over the backend EC2 instances
  
![](https://i.loli.net/2019/08/20/YyhSITpow1LRCVa.png)

- ALB support HTTP/HTTPS & Websockets protocols
- The application servers don’t see the IP of the client directly
  - The true IP of the client is inserted in the header **X-Forwarded-For**
  - We can also get **Port (X-Forwarded-Port)** and **proto (X-Forwarded-Proto)**
  
![](https://i.loli.net/2019/08/20/7mPWhvyFa9Srtsb.png)

- ALB can route on based on hostname / path
- ALB is a great fit with ECS (Docker)

# 2. NLB
- NLB directly see the client IP

# 3. ELB for Solutions Architect
- Classic Load Balancers: questions on security groups, stickiness
- Application Load Balancer (Layer 7 of OSI):
  - Support **routing** based on **hostname**
    - `users.example.com `
    - `payments.example.com`
  - Support **routing** based on **path** 
    - `example.com/users `
    - `example.com/payments`
  - Support redirects (from HTTP to HTTPS for example)
  - Support dynamic host port mapping with ECS
- NLB (Layer 4 of OSI) gets a static IP per AZ:
  - Public facing: must attach Elastic IP – can help whitelist by clients
  - Private facing: will get random private IP based on free ones at time of creation
  - Has cross zone balancing
  - Has SSL termination (Jan 2019)
  
## 3.1 Security Groups
- Load Balancer Security Group all 80 and 443 for all
- Application Security Group: Allow traffic only from Load Balancer's SG

![](https://i.loli.net/2019/08/20/lDrYmJuT4pISALk.png)
![](https://i.loli.net/2019/08/20/SLTO1qsvBI7DFN4.png)

## 3.2 SSL Certificates

- The load balancer uses an X.509 certificate (SSL/TLS server certificate)
- You can manage certificates using ACM (AWS Certificate Manager)
- You can create upload your own certificates alternatively
- HTTPS listener:
  - You must specify a default certificate
    ![](https://i.loli.net/2019/08/20/mECSltvpfc8PFiJ.png)
  - You can add an optional list of certs to support multiple domains
  - Clients can use SNI (Server Name Indication) to specify the hostname they reach
  - Ability to specify a **security policy** to support **older versions** of SSL / TLS (**legacy clients**)
    ![](https://i.loli.net/2019/08/20/iVHgYafFIRtLCK2.png)



# 4. LB for SysOps

- Application Load Balancer:
  - Layer 7 (HTTP, HTTPS,Websocket)
  - URL based routing (hostname or path)
  - **Does not support static IP**, but has a **fixed DNS**
  - Provide SSL termination
- Network Load Balancer:
  - Layer 4 (TCP)
  - No pre-warming needed
  - **1 static IP per subnet**
  - No SSL termination (SSL must be enabled by the application itself)
- Exam tip: Chain an NLB and a ALB to “give” ALB a fixed IP






































































